Unity3D 프로젝트는 자신들이 제공하는 애셋 서버(Asset Server)를 이용해서 버전을 관리한다. 사내에서 서버를 운용할거라면 애셋 서버를 이용해도 되겠지만, 애셋 서버가 유료이기도 하고 Github와 같은 외부 서비스를 이용하거나 기존에 익숙한 버전 관리 도구를 이용하고 싶을 수 있다. 유니티 프로젝트를 Git이나 SVN같은 외부 버전 관리 시스템을 이용해서 관리하려고 할 때 알아두어야 할 내용을 정리한다.

## 외부 버전 관리 시스템을 이용할 수 있도록 설정 변경하기

유니티 프로젝트를 외부 버전 관리 시스템에서 관리하려면 다음 두 가지 설정을 변경하면 된다.

메뉴: Edit > Project Settings > Editor > (Inspector 창)

![](/images/2013/08-21-unity3d_git_1.png)

1. 버전 관리 모드 변경: Version Control > Mode > Meta Files
2. 애셋 직렬화 모드 변경: Asset Serialization > Mode > Force Text

공식 문서인 [Using External Version Control Systems with Unity](http://docs.unity3d.com/Documentation/Manual/ExternalVersionControlSystemSupport.html)에는 Version Control Mode를 Asset Server에서  Meta Files로 바꾸라는 설명 뿐인데, 애셋 직렬화 모드를 변경하지 않으면 씬(Scene) 파일이 바이너리 포맷으로 유지된다.

씬 파일은 기본적으로 바이너리 포맷이고, 직렬화 모드를 변경해야 텍스트 파일로 변경된다. 씬 파일을 바이너리로 놔둔채로 Git이나 SVN에서 버전 관리를 하게 되면 공동 작업이 많이 불편해진다. 텍스트 형식도 알아보기 쉽지는 않지만 자동 merge와 자신이 변경한 내용인지 아닌지 정도는 구분할 수 있다는 차이가 있다.

## 버전 관리를 하지 않아도 되는 파일 추가하기

[공식 문서](http://docs.unity3d.com/Documentation/Manual/ExternalVersionControlSystemSupport.html)에서 설명한대로 유니티 프로젝트의 Library 폴더를 ignore 목록에 추가하면 된다. 그 외에도 불필요한 파일 목록을 넣어둔 Github에서 제공하는 다음 [gitignore 목록](https://github.com/github/gitignore/blob/master/Unity.gitignore)을 활용하는 것도 좋다.

    [Ll]ibrary/
    [Tt]emp/
    [Oo]bj/
    
    # Autogenerated VS/MD solution and project files
    *.csproj
    *.unityproj
    *.sln

## 충돌 처리하기

유니티 프로젝트의 씬 파일(.unity 확장자)은 다루기가 어렵다. 씬에 포함된 계층 구조(Hierarchy)와 인스펙터(Inspector)에서 설정한 다양한 속성 값들이 이 씬 파일에 저장된다. 그래서 여러 사람이 동시에 수정하면 하나의 씬 파일이 여러 사람에 의해서 수정이 된다. 결국 충돌이 발생할 가능성이 크고, 모든 정보를 유지하도록 합쳐야 한다.

먼저, 애셋  서버를 사용하면 알아보기 쉬운 형태로 시각적인 Diff를 제공하는 것이 아닐까 기대했지만 바이너리 파일을 비교해서 보여주고 합치라고 한다.  별 이점이 없다.

그래서 앞의 설정대로 씬 파일을 텍스트 포맷으로 변경하면 그 다음 씬 관리 및 합치기 전략은 간단한다. (iOS 앱 개발할 때 프로젝트 파일이 충돌나는 현상과 비슷하다.)

1. 다른 텍스트 파일과 마찬가지로 가능한 자동으로 합쳐진다. (바이너리 였다면 ...)
2. 충돌이 생기면 같은 곳을 수정한 것이라면 직접 값을 비교해서 맞는 값을 선택한다.
3. 충돌이 생겼지만 같은 항목을 수정한 것이 아니라 서로 동시에 추가해서 텍스트 파일의 같은 위치에 수정이 생긴거라면, 둘 다 넣어준다. 
4. 계층 구조를 이리 저리 옮기고 뜯어 고치는 작업은 가능하면 짧은 시간에 처리하고 서버에 올린다. 사소한 작업이지만 알아보기 어려운 텍스트 파일이 여기저기 옮겨다니며 수정되어 합칠 때 골치가 아프다.

## 주의: 비어 있는 폴더

Git은 비어 있는 폴더를 따로 추적하지 않는다. 근데 유니티는 설정에서 Version Control > Mode를 Meta Files로 변경하면 비어 있는 폴더에 대해서도 "폴더명.meta" 파일을 생성한다.

이 문제로 생길 수 있는 상황을 보자.

1. 철수씨가 A라는 이름의 비어 있는 폴더를 하나 만들면 그 폴더에 대한 A.meta 파일이 생긴다.
2. 철수씨가 이 내용을 서버에 올리면 빈 폴더는 올라가지 않고 A.meta 파일만 서버에 올라간다. 
3. 영희씨가 서버에서 최신 변경사항을 내려받으면 Git에서 추적하지 않기에 A 폴더가 없지만, 서버에서 내려받은 A.meta 파일이 있다.
4.  영희씨가 유니티를 실행하면 존재하지 않는 리소스에 대한 메타파일로 처리되어 A.meta 파일이 지워진다. (git status에 deleted로 표시되고 커밋 대상이 된다.)
5. 영희씨가 다시 서버에 최신 사항을 올리면, A.meta는 지워진 파일로 처리되어 서버에서 제거된다.
6. 철수씨가 최신 사항을 내려받으면 A.meta 파일은 없어진다. 유니티를 실행하면 A 폴더가 여전히 존재하기에 A.meta가 다시 생성이 된다. (git status에는 추적 대상 파일이 새로 생겼다고 표시된다.)

아무런 수정이 없음에도 빈 폴더 때문에 철수씨와 영희씨 모두 변경된 내용이 있다고 지속적으로 표시가 된다. 바꾼 것도 없는데 지워졌다거나 바뀌었다고 나오고 엉망이다.

해결책이야 비어 있는 폴더를 지워버리거나, 간단히 빈 숨김파일(Mac OS X라면 .으로 시작하는 파일명)을 하나 만들어 넣는 방법이 있다. 아니면 .git/hooks/pre-commit 스크립트에서 비어 있는 폴더에 대한 meta 파일을 찾아서 지우도록 할 수도 있을 것이다. 어떤 방법을 써도 좋지만 빈 폴더는 주의해야 한다. 

## 마치며

길게 썼지만 결국 두 가지 설정값을 변경하고, 알아보기 어려운 텍스트 파일인 씬 파일을 조금은 신경쓰고, 빈 폴더를 주의하자는 얘기이다.

그리고 외부 버전 관리 시스템으로 유니티 프로젝트를 버전 관리하려고 관련 자료를 찾아보면, Force Text 옵션에 대해서 변경하는 것이 좋은지 아닌지에 대해서 여러 의견을 볼 수 있다. 텍스트 파일의 크기가 엄청나게 커지는 문제가 있기 때문인데, 그래서 아마 공식 문서에서 콕 찝어 Force Text로 변경하라는 얘기가 없는게 아닐까 싶다. 

개인적으로는 무조건 텍스트 포맷으로 변경해야 한다고 생각한다. 외부 버전 관리 시스템에서 바이너리 파일의 내것이나 네것의 양자택일이 아니라 자동으로 합쳐지거나 적어도 직접 합칠 수 있기 때문이다. 그나마 사람이 알아볼 수 있는 글자로 보여주기도 하고 말이다.

## 관련 자료

1. [Using External Version Control Systems with Unity](http://docs.unity3d.com/Documentation/Manual/ExternalVersionControlSystemSupport.html)
2. [gitignore 모음](https://github.com/github/gitignore)

***

[[게임개발]], [[Git]], [[블로그글]]
